/*!
 * Jacks - 0.1.0 https://github.com/jccazeaux/Jacks
 *  Copyright (c) 2015 Jean-Christophe Cazeaux.
 *  Licensed under the MIT license.
 * 
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.jacks=r():e.jacks=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r){var t=function(){"use strict";function e(){function e(e,r){var t=f[r];if(void 0===t||null===t)throw"No serializer found for type "+r;return t(e)}function n(e,r){var t,n=e;if(t=n.indexOf("?")>0?"&":"?",null!=r)for(var o in r)n+=t+o+"="+encodeURIComponent(r[o]),t="&";return n}function s(e,r){this.xhr=e,this.url=e.responseURL,this.status=e.status,this.statusText=e.statusText,this.responseText=e.responseText;var t=e.getResponseHeader("Content-Type");c[t]?this.response=c[t](e.responseText):this.response=e.responseText,this.headers=e.getAllResponseHeaders(),this.getHeader=function(r){return e.getResponseHeader(r)}}function i(e,r,t,n){this.xhr=e,this.type=t,this.origin=n,this.url=r.url}function u(u,f){function c(){if(window.XMLHttpRequest)return(new XMLHttpRequest).upload?(r=2,j=v):(r=1,j=d),new XMLHttpRequest;r=1,j=d;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1}function l(e,r,t){var n=function(){var n,o={responseText:t.responseText,getAllResponseHeaders:function(){return t.headers},getResponseHeader:function(e){var r=[];if(t.headers)for(var n in t.headers)n.toLowerCase()===e.toLowerCase()&&r.push(t.headers[n]);return r.join(", ")},status:t.status,statusText:t.statusText};n=t.error?function(){var e=new i(o,E,t.error.type,t.error);x("beforeError",{request:E,error:e}),r&&r(e)}:function(){try{var t=new s(o,E);x("beforeResponse",{request:E,response:t}),e&&e(t)}catch(n){var u=new i(o,E,"parsing",n);x("beforeError",{request:E,error:u}),r&&r(u)}},R?setTimeout(n,t.delay||0):n()};"function"==typeof t.response?0===t.response.length?(t.response(),n()):t.response(n):n()}function d(e,r){var t=E.xhr;t.onreadystatechange=function(n){if(4==t.readyState){b();var o;try{o=t.status}catch(n){o=0}if(0!==o)try{var u=new s(t,E);x("beforeResponse",{request:E,response:u}),e&&e(u)}catch(n){var a=new i(t,E,"parsing",n);x("beforeError",{request:E,error:a}),r&&r(a)}else if(E.aborted){var a={type:"abort",url:E.url};if(x("beforeError",{request:E,error:a}),r)return r(a)}else if(E.timedout){var a={type:"timeout",url:E.url};if(x("beforeError",{request:E,error:a}),r)return r(a)}}},t.onerror=function(e){var n=new i(t,E,e.type,e);x("beforeError",{request:E,error:n}),r&&r(n,E)},x("beforeOpen",{request:E}),t.open(u,E.url,R);for(var n in q)t.setRequestHeader(n,q[n])}function v(e,r){var t=E.xhr;t.onload=function(n){b();try{var o=new s(t,E);x("beforeResponse",{request:E,response:o}),e&&e(o)}catch(n){var u=new i(t,E,"parsing",n);x("beforeError",{request:E,error:u}),r&&r(u)}},t.onerror=function(e){var n=new i(t,E,e.type,e);x("beforeError",{request:E,error:n}),r(n)},t.onprogress=function(e){y("progress",e)},t.onabort=function(e){y("abort",e)},t.ontimeout=function(e){y("timeout",e)},t.onloadstart=function(e){y("loadstart",e)},t.onloadend=function(e){y("loadend",e)},t.upload.onprogress=function(e){y("upload-progress",e)},x("beforeOpen",{request:E}),t.open(u,E.url,R);for(var n in q)t.setRequestHeader(n,q[n])}function y(e,r){var t=h[e];if(t)for(var n=0;n<t.length;n++)t[n](r)}function x(e,r){var t=p[e];if(t)for(var n=0;n<t.length;n++)t[n](r)}function b(){T&&(clearTimeout(T),T=null)}function w(){var e;for(var r in t){e=t[r];var n=!1;if(n=e.request.url instanceof RegExp?e.request.url.test(E.url):e.request.url===E.url,n&&(!e.request.method||e.request.method.toUpperCase()===E.requestType.toUpperCase()))return Object.create(e.response)}}var T=null,q={},g=null,m=null,R=!0;this.requestType=u,this.url=f,this.xhr=c();var j,E=this;this.header=function(e,r){return void 0===e?q:(q[e]=r,this)},this.body=function(e){return void 0===name?g:(g=e,this)},this.sync=function(){return R=!1,this},this.query=function(e,r){if(void 0===e)return m;if(m=m||{},"string"==typeof e){m[e]=r;var t={};t[e]=r,E.url=n(E.url,t)}else if("object"==typeof e)for(var o in e)m[o]=e[o],E.url=n(E.url,e);return this},this.use=function(e){if("string"==typeof e){if(null==o[e])throw"Plugin "+a[H]+" not found";o[e](this)}else"function"==typeof e&&e(this);return this},this.send=function(r,t){var n=w();if(n)return l(r,t,n),this;j(r,t);var o=null;if(null!=g&&"object"==typeof g)try{o=e(g,q["Content-Type"])}catch(s){var u=new i(this.xhr,E,"serializer",s);x("beforeError",{request:E,error:u}),t&&t(u)}else o=g;return this.xhr.send(o),this},this.sendAsbinary=function(r,t){var n=w();if(n)return l(r,t,n),this;j(r,t);var o=null;if(null!=g&&"object"==typeof g)try{o=e(g,q["Content-Type"])}catch(s){var u=new i(xhr,E,"serializer",s);x("beforeError",{request:E,error:u}),t&&t(u,E)}else o=g;return xhr.sendAsBinary(o),this},this.abort=function(){return this.aborted=!0,this.xhr.abort(),this},this.timeout=function(e){return setTimeout(function(){this.timedout=!0,this.xhr.abort()},e),this},this.on=function(e,r){return h[e]=h[e]||[],h[e].push(r),this},this.hook=function(e,r){return p[e]=p[e]||[],p[e].push(r),this};for(var H=0;H<a.length;H++)this.use(a[H])}var a=[],f={"application/json":function(e){return JSON.stringify(e)},"application/x-www-form-urlencoded":function(e){var r=[];for(var t in e)r.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return r.join("&")}},c={"application/json":function(e){return JSON.parse(e)}},h={},p={};return this.get=function(e){return new u("GET",e)},this.post=function(e){return new u("POST",e)},this.put=function(e){return new u("PUT",e)},this.options=function(e){return new u("OPTIONS",e)},this.head=function(e){return new u("HEAD",e)},this["delete"]=function(e){return new u("DELETE",e)},this.use=function(e){return a.push(e),this},this.parser=function(e,r){return c[e]=r,this},this.serializer=function(e,r){return f[e]=r,this},this}var r,t=[],n=function(){return new e},o={};return n.plugin=function(e,r){return o[e]=r,this},n.mock=function(e,r){return t.push({request:e,response:r}),this},n.clearMocks=function(){return t=[],this},n}();e.exports=t}])});